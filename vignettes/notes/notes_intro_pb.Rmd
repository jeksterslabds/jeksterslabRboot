---
title: "Notes: Introduction to Parametric Bootstrapping"
author: "Ivan Jacob Agaloos Pesigan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Notes: Introduction to Parametric Bootstrapping}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r}
library(jeksterslabRboot)
```

## Random Variable

```{r, echo = FALSE}
set.seed(42)
n <- 100
mu <- 100
theta <- mu
sigma2 <- 225
sigma <- sqrt(sigma2)
se_muhat <- sqrt(sigma2 / n)
B <- 1000
```

Let $X$ be a random variable
from a normal distribution with $\mu = `r mu`$
and $\sigma^2 = `r sigma2`$.

\begin{equation}
  X
  \sim
  \mathcal{N}
  \left(
    \mu = `r mu`,
    \sigma^2 = `r sigma2`
  \right)
\end{equation}

This data generating function is referred to as $F$.

For a sample size of
$n = `r n`$,
using the know parameters,
the standard error of the mean is

\begin{equation}
  \mathrm{se}
  \left(
    \hat{\mu}
  \right)
  =
  \sqrt{
    \frac{
      \sigma^2
    }
    {
      n
    }
  }
  =
  `r se_muhat`
\end{equation}


```{r, echo = FALSE}
Variable <- c(
  "`n`",
  "`mu`",
  "`sigma2`",
  "`sigma`",
  "`se_muhat`"
)
Description <- c(
  "Sample size $\\left( n \\right)$",
  "Population mean $\\left( \\mu  \\right)$",
  "Population variance $\\left( \\sigma^2 \\right)$",
  "Population standard deviation $\\left( \\sigma \\right)$",
  "Standard error of the sample mean $\\left( \\mathrm{se} \\left( \\hat{\\mu} \\right) = \\sqrt{\\frac{\\sigma^2}{n}} \\right)$"
)
Value <- c(
  n,
  mu,
  sigma2,
  sigma,
  se_muhat
)
knitr::kable(
  x = data.frame(
    Variable,
    Description,
    Value
  ),
  row.names = FALSE,
  caption = "Population Parameters"
)
```

## Realizations of the Random Variable

Let $\mathbf{x}$ be a vector of length $n = `r n`$
of realizations of the random variable $X$. 

```{r}
x <- rnorm(
  n = n,
  mean = mu,
  sd = sigma
)
```

```{r, echo = FALSE}
muhat <- mean(x)
sigma2hat <- var(x)
sigmahat <- sqrt(sigma2hat)
sehat_muhat <- sqrt(sigma2hat / n)
Variable <- c(
  "`n`",
  "`muhat`",
  "`sigma2hat`",
  "`sigmahat`",
  "`sehat_muhat`"
)
Description <- c(
  "Sample size $\\left( n \\right)$",
  "Estimated mean $\\left( \\hat{\\mu} \\right)$",
  "Estimated variance $\\left( \\hat{\\sigma}^2 \\right)$",
  "Estimated standard deviation $\\left( \\hat{\\sigma} \\right)$",
  "Estimated standard error of the sample mean $\\left( \\hat{\\mathrm{se}} \\left( \\hat{\\mu} \\right) = \\sqrt{\\frac{\\hat{\\sigma}^2}{n}} \\right)$"
)
Value <- c(
  n,
  muhat,
  sigma2hat,
  sigmahat,
  sehat_muhat
)
knitr::kable(
  x = data.frame(
    Variable,
    Description,
    Value
  ),
  row.names = FALSE,
  caption = "Parameter Estimates"
)
```

```{r, echo = FALSE}
hist(x)
qqnorm(x)
qqline(x)
```

## Parametric Bootstrapping

$\mathbf{x}$ which is a vector of realizations of the random variable $X$
is used in bootstrapping.
This sample data is referred to as the empirical distribution
$\hat{F}$.

In parametric bootstrapping we make a parametric assumption
about the distribution of $\hat{F}$.
In the current example,
we assume a normal distribution $\hat{F}_{\mathcal{N} \left( \mu, \sigma^2 \right)}$.
Data is generated $B$ number of times (`r B` in the current example)
from the empirical distribution 
$\hat{F}_{\mathcal{N} \left( \hat{\mu}, \hat{\sigma^2} \right)}$
using parameter estimates
($\hat{\mu} = `r muhat`$ and $\hat{\sigma}^2 = `r sigma2hat`$).

### $x^{*} = \left\{ x^{*1}, x^{*2}, x^{*3}, x^{*b}, \dots, x^{*B} \right\}$

$x^{*}$ is a set of $B$ bootstrap samples.

The function `pb_univ()`
from the `jeksterslabRboot` package
can be used to generate `B`
parametric bootstrap samples from a univariate probability distribution.

```{r}
x_star <- nb(
  data = x,
  B = B
)
```

### $\hat{\theta}^{*} = \left\{ \hat{\theta}^{*} \left( 1 \right), \hat{\theta}^{*} \left( 2 \right), \hat{\theta}^{*} \left( 3 \right), \hat{\theta}^{*} \left( b \right), \dots, \hat{\theta}^{*} \left( B \right)\right\}$

The parameter is estimated for each of the $B$
bootstrap samples.
For example,
if we are interested in making inferences about the mean,
we estimate the mean $B$ times.
The estimated parameters form the bootstrap sampling distribution
$\hat{\theta}^{*}$.

```{r}
thetahat_star <- sapply(
  X = x_star,
  FUN = mean
)
```

```{r, echo = FALSE}
hist(
  thetahat_star,
  main = expression(
    paste(
      "Histogram of ",
      hat(theta),
      "*"
    )
  ),
  xlab = expression(
    paste(
      hat(theta),
      "*"
    )
  )
)
qqnorm(thetahat_star)
qqline(thetahat_star)
```

### $\hat{\mathrm{se}}_{\mathrm{B}} \left( \hat{\theta} \right)$

```{r, echo = FALSE}
sd_thetahat_star <- sd(thetahat_star)
mean_thetahat_star <- mean(thetahat_star)
```

The estimated bootstrap standard error
is given by

\begin{equation}
  \hat{\mathrm{se}}_{\mathrm{B}}
  \left(
    \hat{\theta}
  \right)
  =
  \sqrt{
    \frac{1}{B - 1}
    \sum_{b = 1}^{B}
    \left[
      \hat{\theta}^{*} \left( b \right)
      -
      \hat{\theta}^{*} \left( \cdot \right)
    \right]^2
  }
  =
  `r sd_thetahat_star`
\end{equation}

\noindent where

\begin{equation}
  \hat{\theta}^{*}
  \left(
    \cdot
  \right)
  =
  \frac{1}{B}
  \sum_{b = 1}^{B}
  \hat{\theta}^{*} \left( b \right) 
  =
  `r mean_thetahat_star`
  .
\end{equation}

Note that
$\hat{\mathrm{se}}_{\mathrm{B}} \left( \hat{\theta} \right)$
is the standard deviation of
$\hat{\theta}^{*}$
and
$\hat{\theta}^{*} \left( \cdot \right)$
is the mean of
$\hat{\theta}^{*}$ .

### Confidence Intervals

Confidence intervals can be constructed
around
$\hat{\theta}$ .
The functions
`pc()`,
`bc()`,
and
`bca()`
from
the `jeksterslabRboot` package
can be used to construct
confidence intervals
using the default alphas
of
$0.001$,
$0.01$,
and
$0.05$.
Walds confidence intervals (`wald()`)
are added for comparison.
The confidence intervals can also be evaluated.
See
`zero_hit()`,
`theta_hit()`,
`len()`,
and
`shape()`
from
the `jeksterslabRboot` package.
Since we know the population parameter theta
$\left(\theta = \mu = `r theta` \right)$,
we can check if our confidence intervals contain
the population parameter.

```{r}
wald <- wald(
  thetahat = muhat,
  sehat_thetahat = sehat_muhat,
  eval = TRUE,
  theta = theta
)
pc <- pc(
  thetahat_star = thetahat_star,
  thetahat = muhat,
  wald = TRUE,
  eval = TRUE,
  theta = theta
)
bc <- bc(
  thetahat_star = thetahat_star,
  thetahat = muhat,
  wald = TRUE,
  eval = TRUE,
  theta = theta
)
bca <- bca(
  thetahat_star = thetahat_star,
  thetahat = muhat,
  data = x,
  fitFUN = mean,
  wald = TRUE,
  eval = TRUE,
  theta = theta
)
```

```{r}
knitr::kable(
  x = as.data.frame(
    rbind(
      wald,
      pc,
      bc,
      bca
    )
  ),
  caption = "Confidence Intervals"
)
```

## Notes

The estimated bootstrap standard error
is similar to results from the closed form solution.
The estimated bootstrap confidence intervals
are also close to the Wald's confidence intervals.
While a closed form solution for the standard error is available
in this simple example,
bootstrap standard errors and confidence intervals
can be used in situations
when standard errors are not easy to calculate.
